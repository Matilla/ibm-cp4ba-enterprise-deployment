kind: ConfigMap
apiVersion: v1
metadata:
  name: mailserver.config
  namespace: mail
  labels:
    app: mailserver
data:
  postfix-virtual.cf: |
    cpuser@{{ lc_ldap_domain }} cpuser@{{ lc_ldap_domain }}
    @{{ lc_ldap_domain }} {{ lc_principal_admin_user }}@{{ lc_ldap_domain }}

  postfix-main.cf: |
    smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: mailserver.env.config
  namespace: mail
  labels:
    app: mailserver
data:
  # Cannot be set to cp.local, otherwise postfix is eating mails, some details at https://github.com/docker-mailserver/docker-mailserver/issues/968
  OVERRIDE_HOSTNAME: relay.local
  ENABLE_FETCHMAIL: "0"
  ENABLE_SPAMASSASSIN: "0"
  ENABLE_CLAMAV: "0"
  ENABLE_FAIL2BAN: "0"
  ENABLE_POSTGREY: "0"
  ENABLE_AMAVIS: "0"
  ENABLE_SRS: "0"
  ENABLE_QUOTAS: "0"
  ENABLE_UPDATE_CHECK: "0"
  ENABLE_SASLAUTHD: "0"
  ONE_DIR: "1"
  DMS_DEBUG: "0"
  SSL_TYPE: "manual"
  SSL_CERT_PATH: "/tmp/ssl/tls.crt"
  SSL_KEY_PATH: "/tmp/ssl/tls.key"
  ENABLE_LDAP: "1"
  LDAP_SERVER_HOST: "{{ 'ldap://'+lc_ldap_server+':'+lc_ldap_port if not lc_ldap_use_ssl else 'ldaps://'+lc_ldap_server+':'+lc_ldap_port }}" 
  LDAP_SEARCH_BASE: "{{ lc_ldap_base_dn }}"
  LDAP_BIND_DN: "{{ lc_bind_admin_user }}"
  LDAP_BIND_PW: "{{ lc_bind_admin_password }}"
  LDAP_QUERY_FILTER_USER: "(&(objectclass={{ lc_ldap_user_object_class }})(mail=%s))"
  LDAP_QUERY_FILTER_GROUP: "(&(objectclass={{ lc_ldap_group_object_class }})(mail=%s))"
  LDAP_QUERY_FILTER_DOMAIN: "(mail=*@%s)"